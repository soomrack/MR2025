#include <stdio.h>
#include <stdlib.h>

typedef unsigned long long int Money;

const int START_YEAR = 2025;
const int START_MONTH = 9;
const int PERIOD = 30;  // период симуляции

typedef struct Person  {
    long long int account; //свободные деньги
    Money capital; //капитал
    Money premia; //премия
    Money salary; //зарплата
    Money monthly_payment; //ежемесячный платёж
    Money necessary_expenses; //необходимые траты
    Money contribution; //вклад
    Money cost_house; //стоимость дома
    double rate_contribution; //ставка по вкладу
} Person;


Person Alice;
Person Bob;


void Bob_init()
{
    Bob.capital = 0;
    Bob.account = 0;
    Bob.salary = 300 * 1000;
    Bob.monthly_payment = 50 * 1000;
    Bob.necessary_expenses = 50 * 1000;
    Bob.contribution = 1500 * 1000;
    Bob.rate_contribution = 1.014; // вклад под 17% годовых
}


void Alice_init()
{
    Alice.capital = 0;
    Alice.account = 0;
    Alice.salary = 300 * 1000;
    Alice.premia = 300 * 1000/2 ;
    Alice.monthly_payment = 192466; //на 30 лет через калькулятор ипотеки от яндекса под 17%
    Alice.necessary_expenses = 50 * 1000;
    Alice.contribution = 0;
    Alice.cost_house = 15 * 1000 * 1000;
    Alice.rate_contribution = 1.014; // вклад под 17% годовых
}

// для генерации случайного значения инфляции
double search_inflation() // данные взяты с https://calcus.ru/inflyaciya с 2010-2023 год
{ 
    int probability = (rand() % 100);
    double inflation;
    
    // Распределение вероятностей для разных уровней инфляции
    if (probability > 90) {
        inflation = (1001 + rand() % 2);
    }
    else if (probability <= 90 && probability > 60) {
        inflation = (1004 + rand() % 2);
    }
    else if (probability <= 60 && probability > 10) {
        inflation = (1007 + rand() % 2);
    }
    else {  // probability <= 10
        inflation = (1010 + rand() % 4);
    }
    
    return (double) inflation / 1000.0;
}

// для индексации зарплаты
double indexation()
{
    return (double) (100 + rand() % 9) / 100.0;
}


void Bob_salary(const int month) // Функция начисления зарплаты Бобу
{
    if (month == 1) {
        Bob.salary *= indexation();
    }
    Bob.account = Bob.salary;
}


void Alice_salary(const int month, const int total_months_passed) // ИСПРАВЛЕНО: добавлен параметр
{
    static int salary_doubled = 0; // Флаг: была ли зарплата уже удвоена
  
    if (month == 1) {
        Alice.salary *= indexation();
        Alice.premia = Alice.salary / 2;
    }

    Alice.account = Alice.salary; // Начисляем базовую зарплату

    // Проверяем, прошло ли 5 лет и 3 месяца с начала симуляции (63 месяца)
    if (total_months_passed >= 63 && salary_doubled == 0) {
        Alice.salary *= 2;                   // Удваиваем зарплату
        salary_doubled = 1;                  // Устанавливаем флаг, что зарплата удвоена
        Alice.premia = Alice.salary / 2;     // Премия тоже удваивается (половина новой зарплаты)
    }
    
    if (month == 12) {
        Alice.account += Alice.salary;
    }
    
    // Премия начисляется каждые 3 месяца 
    if (month % 3 == 0) {  
        Alice.account += Alice.premia;
    }
}


void Bob_expenses(const double inflation)
{
    Bob.necessary_expenses *= inflation;
    Bob.account -= Bob.necessary_expenses;
    Bob.monthly_payment *= inflation;
    Bob.account -= Bob.monthly_payment;
}


void Alice_expenses(const double inflation)
{
    Alice.necessary_expenses *= inflation;
    Alice.account -= Alice.necessary_expenses;
    Alice.account -= Alice.monthly_payment;
}


void Bob_contribution()
{
    Bob.contribution = (Bob.contribution + Bob.account) * Bob.rate_contribution;
}


void Alice_contribution()
{
    Alice.contribution = (Alice.contribution + Alice.account) * Alice.rate_contribution;
}


void Alice_capital(const double inflation)
{
    Alice.cost_house *= inflation;
    Alice.capital = Alice.contribution + Alice.cost_house;
}


void Bob_capital(const double inflation)
{
    Bob.capital = Bob.contribution;
}


void simulation()
{
    int month = START_MONTH, year = START_YEAR;
    int total_months_passed = 0;  //  добавляем счётчик месяцев

    while (year < START_YEAR + PERIOD)  {
        double inflation = search_inflation();  // ИСПРАВЛЕНО: Money -> double

        Alice_salary(month, total_months_passed);
        Alice_expenses(inflation);
        Alice_contribution();
        Alice_capital(inflation);

        Bob_salary(month);
        Bob_expenses(inflation);
        Bob_contribution();
        Bob_capital(inflation); 

        month++;
        total_months_passed++;  // ИСПРАВЛЕНО: увеличиваем счётчик каждый месяц
        
        if (month > 12)  {
            year++;
            month = 1;
        }
    }
}


void print()
{
    printf("Капитал Алисы: %lld\n", Alice.capital);
    printf("Капитал Боба: %lld\n", Bob.capital);

    if (Alice.capital > Bob.capital)  {
        printf("Алиса выиграла!\n");
    }
    else  {
        printf("Боб выиграл!\n");
    }
}


int main()
{
    Bob_init();
    Alice_init();

    simulation();

    print();
    
    return 0;
}
